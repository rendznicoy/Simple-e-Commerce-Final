<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ShopSphere | Admin Login</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/Simple-e-Commerce-PHP/style.css" />
    <link
      rel="shortcut icon"
      href="/Simple-e-Commerce-PHP/Images/ShopSphere.png"
      type="image/x-icon"
    />
    <script
      src="https://kit.fontawesome.com/d9be89f74b.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div
      class="container d-flex justify-content-center align-items-center min-vh-100"
    >
      <div class="row border rounder-5 p-3 bg-white shadow box-area">
        <div
          class="col-md-6 rounder-4 d-flex justify-content-center align-items-center flex-column left-box"
        >
          <div class="bg-image mb-3">
            <img
              src="/Simple-e-Commerce-PHP/Images/shopsphere-big.png"
              class="img-fluid"
            />
          </div>
          <p class="text-white fs-2 label">ShopSphere</p>
          <small class="text-white text-wrap text-center label-two"
            >Explore. Discover. <br />ShopSphere: Your Gateway to Limitless
            Choices.</small
          >
        </div>
        <div class="col-md-6 right-box">
          <div class="row align-items-center">
            <div class="header-text md-4">
              <h2>Sign In</h2>
              <p>Welcome Admin!</p>
            </div>
            <div class="input-group mb-3">
              <input
                type="text"
                class="form-control form-control-lg bg-light fs-6"
                id="username"
                placeholder="Username"
                aria-label="Username"
                aria-describedby="basic-addon1"
                required
              />
            </div>
            <div class="input-group mb-1">
              <input
                type="password"
                class="form-control form-control-lg bg-light fs-6"
                id="password"
                placeholder="Password"
                aria-label="Password"
                aria-describedby="basic-addon1"
                required
              />
              <button
                class="btn btn-outline-secondary"
                type="button"
                id="toggle"
              >
                <img
                  src="/Simple-e-Commerce-PHP/Images/view.png"
                  alt="Show Password"
                  id="show"
                />
                <img
                  src="/Simple-e-Commerce-PHP/Images/hide.png"
                  alt="Hide Password"
                  id="hide"
                />
              </button>
            </div>
            <div class="input-group mb-5 d-flex justify-content-between">
              <div class="form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="form-check"
                />
                <label for="form-check" class="form-check-label text-secondary"
                  ><small>Remember Me</small></label
                >
              </div>
              <div class="forgot">
                <small
                  ><a href="/Simple-e-Commerce-PHP/forgot.html"
                    >Forgot Password?</a
                  ></small
                >
              </div>
            </div>
            <div class="input-group mb-3">
              <input
                type="submit"
                class="btn btn-lg btn-primary w-100 fs-6"
                id="sign"
                value="Sign In"
              />
            </div>
          </div>
          <div class="input-group mb-3">
            <button class="btn btn-lg btn-light w-100 fs-6" disabled>
              <img
                src="/Simple-e-Commerce-PHP/Images/google.png"
                class="googil me-2"
              /><small>Sign In with Google</small>
            </button>
          </div>
          <div class="row">
            <small style="text-align: center"
              >Our Google Sign In function is under maintenance <br />We
              apologize for the inconvenience<a href="#"></a
            ></small>
          </div>
        </div>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="/Simple-e-Commerce-PHP/script.js"></script>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        get,
        child,
      } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-database.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-analytics.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries

      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyBfQt95MFDEF0ZvyKjkW5ZB2hcxBxOfZrs",
        authDomain: "simple-ecommerce-2ae23.firebaseapp.com",
        projectId: "simple-ecommerce-2ae23",
        storageBucket: "simple-ecommerce-2ae23.appspot.com",
        messagingSenderId: "649449198685",
        appId: "1:649449198685:web:c305061725d287ab30e9b4",
        measurementId: "G-R02NLXEX21",
        databaseURL:
          "simple-ecommerce-2ae23-default-rtdb.asia-southeast1.firebasedatabase.app",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);

      //Fetch Database
      const db = getDatabase(app);

      // Function to handle "Remember Me" checkbox
      document
        .getElementById("sign")
        .addEventListener("click", async function (e) {
          e.preventDefault();
          const username = document.getElementById("username").value;
          const password = document.getElementById("password").value;
          const rememberMe = document.getElementById("form-check").checked;

          // Check if either username or password is empty
          if (username.trim() === "" || password.trim() === "") {
            alert("Please fill in both username and password fields.");
            return; // Stop execution if fields are empty
          }

          // Encode the username to remove forbidden characters
          const encodedUsername = encodeURIComponent(username);

          try {
            const userSnapshot = await get(
              child(ref(db), `user/${encodedUsername}`)
            );
            const userData = userSnapshot.val();
            if (userData && userData.password === password) {
              // Authentication successful
              if (rememberMe) {
                // Remember Me checkbox is checked, store flag in localStorage
                localStorage.setItem("rememberedUser", username);
              } else {
                // Remember Me checkbox is not checked, clear stored flag
                localStorage.removeItem("rememberedUser");
              }
              // Redirect to a new page
              window.location.href = "admin-home.html";
            } else {
              // Username or password doesn't exist
              alert("Username or password is incorrect.");
            }
          } catch (error) {
            console.error("Error signing in:", error);
            alert("Error signing in. Please try again.");
          }
        });

      // Check if "Remember Me" flag is set in localStorage when the page loads
      window.addEventListener("DOMContentLoaded", (event) => {
        const rememberedUser = localStorage.getItem("rememberedUser");
        if (rememberedUser) {
          // Populate the username input field with the remembered username
          document.getElementById("username").value = rememberedUser;
          // Check the "Remember Me" checkbox
          document.getElementById("form-check").checked = true;
        }
      });
    </script>
  </body>
</html>
